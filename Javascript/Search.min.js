const jsonUrl="https://raw.githubusercontent.com/tokyodebate/motions/main/Javascript/TournamentList.json",tagValue={NA:"NA",BP:"BP",Asian:"AP",Australasian:"Austral",rookie:"Rookie",open:"Open",proam:"Pro-am",schools:"Schools","region:Domestic":"Domestic",international:"","region:World":"Worldwide","region:Asia":"Asia","region:Oceania":"Oceania","region:Europe":"Europe","region:America":"America"};var tournamentInfo;function hashResponse(){let t=new URL(document.URL).hash;if(t.includes("tournament=")){$("section#display-tournament").show(),$("section#display-search").hide();fetchTournament(t.match(/(?<=tournament\=).*/)[0])}else{$("section#display-tournament").hide(),$("section#display-search").show();const a=t.match(/(?<=name\=)[^&]*/),s=t.match(/(?<=format\=)[^&]*/),n=t.match(/(?<=eligibility\=)[^&]*/),e=t.match(/(?<=region\=)[^&]*/),o=t.match(/(?<=year\=)[^&]*/);searchTournament(null===a?void 0:a[0].replace("+"," "),null===s?void 0:s[0].split("+"),null===n?void 0:n[0].split("+"),null===e?void 0:e[0].split("+"),null===o?void 0:parseInt(o[0]))}}function fetchTournament(t){$("section#display-tournament").empty(),foundTournament=tournamentInfo.find((a=>a.id===t)),void 0!==foundTournament?loadMotions("https://raw.githubusercontent.com/tokyodebate/motions/main/"+foundTournament.url):$('<p class="h2">Tournament not found</p>').appendTo("section#display-tournament")}function searchTournament(t,a,s,n,e){let o=tournamentInfo.filter((o=>!(void 0!==t&&!o.name.toLowerCase().includes(t.toLowerCase())&&!o.short.toLowerCase().includes(t.toLowerCase()))&&((void 0===a||!a.every((t=>!o.tag.includes(t))))&&((void 0===s||!s.every((t=>!o.tag.includes(t))))&&((void 0===n||!n.every((t=>!o.tag.includes("region:"+t))))&&!(void 0!==e&&o.latest<e))))));o.sort(((t,a)=>t.name.toUpperCase().localeCompare(a.name.toUpperCase()))),$("section#display-search").empty();for(const t of o){const a=$('<div class="gap-1 d-flex align-items-baseline"></div>').appendTo($('<div class="py-4 list-group-item"></div>').appendTo("section#display-search").append(`<div class="mb-2"><a class="link-danger link-underline-opacity-0 h2" href="#tournament=${t.id}">${t.name}${""==t.short?"":" ("+t.short+")"}</a><span class="badge bg-secondary-subtle border border-secondary-subtle text-secondary-emphasis rounded-pill ms-3">~${t.latest}</span></div>`));t.tag.forEach((t=>{a.append(`<span class="badge bg-danger-subtle border border-danger-subtle text-danger-emphasis rounded-pill">${tagValue[t]}</span>`)}))}}function loadMotions(t){Papa.parse(t,{download:!0,delimiter:"\t",quoteChar:"",escapeChar:"",header:!1,skipEmptyLines:"greedy",complete:function(t){showMotions(t.data)}})}function len(t){return t?t.length:0}function showMotions(t){myRoundLabel=$("<p></p>"),myMotionsList=[],myTournamentName="",myArticle=$("<article></article>").appendTo("section#display-tournament"),myArticle.append(`<p class="h2">Motions for ${t[0][0]}</p>`);for(var a=0;a<t.length;a++)switch(len(t[a])){case 2:myTournamentName=t[a][1],myTournament=$("<div class='card-body'></div>").appendTo($("<div class='card mb-3'></div>").appendTo(myArticle)).append(`<h3 class="card-title px-3">${myTournamentName}</h3>`);break;case 3:myRoundLabel&&createCopyButton(myMotionsList,myRoundLabel),myRound=$("<div class='card-body'></div>").appendTo(myTournament),myMotionsList=[],myRoundLabel=$(`<div class='card-header border-bottom border-danger d-flex justify-content-between align-items-center'>${t[a][2]}</div>`).appendTo(myRound);break;case 4:myMotion=$("<div style='display: flex; flex-direction: column'></div>").appendTo(myRound).append(`<h3 class="card-title px-3 pt-4">${t[a][3]}</h3>`),myMotionsList.push([t[a][3],""]);break;case 5:t[a][4].includes("$stats")?showStats(t[a][4],myMotion):(myMotion.append($(`<p class="card-text mx-3 px-3 fs-4">${t[a][4]}</p>`)),myMotionsList[myMotionsList.length-1][1]+=t[a][4]+"\n")}createCopyButton(myMotionsList,myRoundLabel)}function showStats(t,a){switch(textSplit=t.split(/ ?\$stats ?/),stats=textSplit[1].split(/[ |,]+/),myBar=$('<div class="card-subtitle stats-row mx-3 px-3 pt-4"></div>').append(`<div class="stats-label fs-4">${textSplit[0]}</div>`).appendTo(a),stats.length){case 2:myBar.append($(`<div class="stats-container" style="grid-template-columns: ${stats[0]}fr ${stats[1]}fr;">\n\t\t\t\t\t\t<div class="stats-bar stats-blue">${stats[0]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-red">${stats[1]}</div>\n\t\t\t\t\t</div>`));break;case 3:myBar.append($(`<div class="stats-container" style="grid-template-columns: ${stats[0]}fr ${stats[1]}fr ${stats[2]-stats[0]-stats[1]}fr;">\n\t\t\t\t\t\t<div class="stats-bar stats-blue">${stats[0]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-red">${stats[1]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-gray">${stats[2]-stats[0]-stats[1]}</div>\n\t\t\t\t\t</div>`));break;case 4:myBar.append($(`<div class="stats-container" style="grid-template-columns: ${stats[0]}fr ${stats[1]}fr ${stats[2]}fr ${stats[3]}fr;">\n\t\t\t\t\t\t<div class="stats-bar stats-blue">${stats[0]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-blue-light">${stats[1]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-red-light">${stats[2]}</div>\n\t\t\t\t\t\t<div class="stats-bar stats-red">${stats[3]}</div>\n\t\t\t\t\t</div>`))}}function createCopyButton(t,a){var s="",n="";if(1===t.length)s=`\n\n**Motion**: ${t[0][0]}`,""!=t[0][1]&&(n=`**\n\nInfo**: ${t[0][1]}`);else if(t.length<=3&&t.length>=1)for(var e=0;e<3;e++)s+=`\n\n**Motion ${["A","B","C"][e]}**: ${t[e][0]}`,""!=t[e][1]&&(n+=`\n\n**Info ${["A","B","C"][e]}**: ${t[e][1]}`);s+=`\n\n(${a.text().split(":")[0]}, ${myTournamentName}`,myButtons=$("<div class='d-inline'></div>").appendTo(a),""!=n&&$("<button class='btn btn-outline-secondary fs-4'>Copy Info</button>").appendTo(myButtons).on("click",(function(){navigator.clipboard.writeText(n.slice(2))})),$("<button class='btn btn-outline-secondary fs-4'>Copy Motion</button>").appendTo(myButtons).on("click",(function(){navigator.clipboard.writeText(s.slice(2))}))}fetch(jsonUrl).then((t=>t.json())).then((t=>{tournamentInfo=t,hashResponse(),window.addEventListener("hashchange",hashResponse)})),$("#search-tournaments").click((t=>{nameInput=$("#nameInput").val(),formatInput=$("#div-format :checked").map((function(){return $(this).val()})).toArray(),typeInput=$("#div-type :checked").map((function(){return $(this).val()})).toArray(),regionInput=$("#div-region :checked").map((function(){return $(this).val()})).toArray(),yearInput=$("#yearInput").val(),hashArray=[],""!=nameInput&&hashArray.push(`name=${nameInput.replace(" ","+")}`),0!==formatInput.length&&hashArray.push(`format=${formatInput.join("+")}`),0!==typeInput.length&&hashArray.push(`eligibility=${typeInput.join("+")}`),0!==regionInput.length&&hashArray.push(`region=${regionInput.join("+")}`),""!=yearInput&&hashArray.push(`year=${yearInput}`),window.location.hash="#"+hashArray.join("&")})),$("#reset").click((()=>{window.location.hash=""}));